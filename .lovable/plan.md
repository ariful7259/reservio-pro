
## টাকা পাঠানোর মাল্টি-মেথড সিস্টেম

বর্তমানে `SendMoneyDialog` শুধুমাত্র ফোন নম্বর দিয়ে টাকা পাঠাতে পারে। আমরা এটিকে আপগ্রেড করে ৪টি পদ্ধতিতে টাকা পাঠানোর সুবিধা যোগ করব:

### ফিচার সামারি

| পদ্ধতি | কাজ |
|--------|-----|
| **ফোন নম্বর** | প্রাপকের ফোন নম্বর দিয়ে সরাসরি টাকা পাঠান |
| **ইমেইল** | প্রাপকের ইমেইল দিয়ে টাকা পাঠান |
| **লিংক** | পেমেন্ট লিংক তৈরি করে শেয়ার করুন (প্রাপক লিংকে ক্লিক করে টাকা রিসিভ করবে) |
| **QR কোড** | QR স্ক্যান করে সরাসরি পেমেন্ট করুন |

---

### পরিবর্তনসমূহ

#### 1. SendMoneyDialog আপগ্রেড (src/components/wallet/SendMoneyDialog.tsx)

**বর্তমান অবস্থা:** শুধু ফোন নম্বর দিয়ে পাঠানো যায়

**নতুন ডিজাইন:**
- ৪টি ট্যাব সহ UI: `ফোন` | `ইমেইল` | `লিংক` | `QR`
- প্রতিটি ট্যাবে আলাদা ইনপুট ফর্ম

**ট্যাব বিবরণ:**

1. **ফোন ট্যাব** (বিদ্যমান)
   - ফোন নম্বর ইনপুট
   - পরিমাণ ও বিবরণ
   - সরাসরি পাঠান

2. **ইমেইল ট্যাব** (নতুন)
   - ইমেইল ইনপুট
   - profiles টেবিল থেকে email দিয়ে প্রাপক খোঁজা
   - একই লজিক ব্যবহার করে টাকা ট্রান্সফার

3. **লিংক ট্যাব** (নতুন)
   - পরিমাণ ও বিবরণ ইনপুট
   - মেয়াদ নির্বাচন (15m, 1h, 24h, 7d)
   - `send_payment_requests` টেবিলে সেভ
   - এনকোডেড পেমেন্ট লিংক ও QR কোড জেনারেট
   - লিংক কপি ও শেয়ার অপশন
   - **প্রাপক লিংকে ক্লিক করলে টাকা তার ওয়ালেটে চলে যাবে**

4. **QR ট্যাব** (নতুন)
   - ক্যামেরা দিয়ে QR স্ক্যান
   - গ্যালারি থেকে QR সিলেক্ট
   - স্ক্যান করা তথ্য দিয়ে পেমেন্ট কনফার্মেশন

---

#### 2. নতুন ডাটাবেজ টেবিল

**send_payment_requests** (টাকা পাঠানোর লিংক সংরক্ষণ)
```sql
CREATE TABLE send_payment_requests (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  sender_id UUID REFERENCES auth.users(id) NOT NULL,
  amount NUMERIC NOT NULL CHECK (amount > 0),
  description TEXT,
  qr_code_data TEXT,
  expires_at TIMESTAMPTZ NOT NULL,
  status TEXT DEFAULT 'active' CHECK (status IN ('active', 'claimed', 'expired', 'cancelled')),
  claimed_by UUID REFERENCES auth.users(id),
  claimed_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

#### 3. পেমেন্ট লিংক ক্লেইম সিস্টেম

**নতুন URL প্যারামিটার হ্যান্ডলিং:**
- `/wallet?claim=<encoded_data>` - টাকা নেওয়ার লিংক

**নতুন ডায়ালগ:** `ClaimPaymentDialog`
- প্রেরকের নাম, পরিমাণ, বিবরণ দেখাবে
- মেয়াদ চেক করবে
- "টাকা নিন" বাটনে ক্লিক করলে:
  - প্রেরকের ওয়ালেট থেকে টাকা কাটবে
  - প্রাপকের ওয়ালেটে যোগ হবে
  - ট্রানজেকশন রেকর্ড তৈরি হবে
  - স্ট্যাটাস 'claimed' হয়ে যাবে

---

#### 4. Wallet.tsx আপডেট

- `claim` URL প্যারামিটার হ্যান্ডলিং
- `ClaimPaymentDialog` ইন্টিগ্রেশন
- SendMoneyDialog-এ QR স্ক্যান সাপোর্ট

---

### ফাইল পরিবর্তন

| ফাইল | পরিবর্তন |
|------|----------|
| `src/components/wallet/SendMoneyDialog.tsx` | সম্পূর্ণ রিডিজাইন - ৪ ট্যাব সহ |
| `src/components/wallet/ClaimPaymentDialog.tsx` | নতুন - লিংক থেকে টাকা নেওয়ার ডায়ালগ |
| `src/pages/Wallet.tsx` | claim প্যারামিটার হ্যান্ডলিং যোগ |

---

### কারিগরি বিবরণ

#### ইমেইল দিয়ে প্রাপক খোঁজা
```typescript
const { data: recipientProfile } = await supabase
  .from('profiles')
  .select('id, full_name, email')
  .eq('email', formData.recipientEmail)
  .single();
```

#### পেমেন্ট লিংক ডেটা স্ট্রাকচার
```typescript
{
  type: 'send_payment',
  request_id: 'uuid',
  sender_id: 'uuid',
  sender_name: 'নাম',
  amount: 500,
  description: 'বিবরণ',
  expires_at: 'ISO timestamp'
}
```

#### ক্লেইম প্রসেস ফ্লো
1. প্রাপক লিংক খোলে
2. `ClaimPaymentDialog` প্রদর্শিত হয়
3. প্রাপক "টাকা নিন" ক্লিক করে
4. `process_wallet_debit` দিয়ে প্রেরকের টাকা কাটা হয়
5. প্রাপকের ওয়ালেটে টাকা যোগ হয়
6. উভয়ের জন্য ট্রানজেকশন তৈরি হয়
7. রিসিপ্ট দেখানো হয়

---

### UI ফ্লো ডায়াগ্রাম

```text
+--------------------------------------------------+
|              টাকা পাঠান                           |
+--------------------------------------------------+
| [ফোন] [ইমেইল] [লিংক] [QR]                         |
+--------------------------------------------------+
|                                                   |
|  ফোন ট্যাব:                                       |
|  +------------------------------------------+    |
|  | প্রাপকের ফোন: [01XXXXXXXXX           ]  |    |
|  | পরিমাণ:      [0.00                    ]  |    |
|  | বিবরণ:       [ঐচ্ছিক                  ]  |    |
|  |                                          |    |
|  |        [টাকা পাঠান]                     |    |
|  +------------------------------------------+    |
|                                                   |
|  লিংক ট্যাব:                                      |
|  +------------------------------------------+    |
|  | পরিমাণ:      [500                     ]  |    |
|  | বিবরণ:       [পণ্য কেনা               ]  |    |
|  | মেয়াদ:       [24 ঘণ্টা ▼             ]  |    |
|  |                                          |    |
|  |        [লিংক তৈরি করুন]                 |    |
|  +------------------------------------------+    |
|                                                   |
|  লিংক তৈরি হলে:                                   |
|  +------------------------------------------+    |
|  |      [QR CODE]                           |    |
|  |                                          |    |
|  |  https://...?claim=abc...                |    |
|  |  [কপি করুন] [শেয়ার করুন]               |    |
|  +------------------------------------------+    |
|                                                   |
+--------------------------------------------------+
```
